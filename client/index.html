<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lobby System</title>
    <style>
        .container {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        .user-panel {
            border: 1px solid #ccc;
            padding: 10px;
            width: 45%;
        }
        .user-panel input {
            margin-bottom: 10px;
            width: 100%;
            box-sizing: border-box;
        }
        .timer {
            font-size: 24px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <input type="text" id="usernameInput" placeholder="Enter your username" required>
    <button id="createLobbyBtn">Create Lobby</button>
    <input type="text" id="lobbyIdInput" placeholder="Enter lobby ID">
    <button id="joinLobbyBtn">Join Lobby</button>

    <div id="lobbyDetails" style="display: none;">
        <div class="container">
            <div class="user-panel" id="user1Panel">
                <h3>User 1</h3>
                <input type="text" id="user1Name" placeholder="User 1 Name" readonly>
                <input type="text" id="user1Message" placeholder="Enter message">
                <input type="checkbox" id="user1Checkbox"> Start Timer
            </div>
            <div class="user-panel" id="user2Panel">
                <h3>User 2</h3>
                <input type="text" id="user2Name" placeholder="User 2 Name" readonly>
                <input type="text" id="user2Message" placeholder="Enter message">
                <input type="checkbox" id="user2Checkbox"> Start Timer
            </div>
        </div>
        <div class="timer" id="timer" style="display: none;"></div>
    </div>

    <script src="https://cdn.socket.io/4.3.1/socket.io.min.js"></script>
    <script>
        const socket = io.connect('http://localhost:3000/');
        const lobbyDetails = document.getElementById('lobbyDetails');
        const createLobbyBtn = document.getElementById('createLobbyBtn');
        const joinLobbyBtn = document.getElementById('joinLobbyBtn');
        const lobbyIdInput = document.getElementById('lobbyIdInput');
        
        createLobbyBtn.addEventListener('click', () => {
            const username = document.getElementById('usernameInput').value;
            socket.emit('create_lobby', username, (lobbyId) => {
                console.log('Lobby created with ID:', lobbyId);
                showLobbyDetails(lobbyId, true);
            });
        });

        joinLobbyBtn.addEventListener('click', () => {
            const lobbyId = lobbyIdInput.value;
            const username = document.getElementById('usernameInput').value;
            socket.emit('join_lobby', lobbyId, username, (success, message) => {
                if (success) {
                    console.log('Joined lobby:', lobbyId);
                    showLobbyDetails(lobbyId, false);
                } else {
                    console.log('Failed to join lobby:', message);
                }
            });
        });

        function showLobbyDetails(lobbyId, isCreator) {
            lobbyDetails.style.display = 'block';
            const user1Panel = document.getElementById('user1Panel');
            const user2Panel = document.getElementById('user2Panel');

            if (isCreator) {
                user1Panel.querySelector('input').readOnly = false;
                user1Panel.querySelector('input[type="checkbox"]').disabled = false;
                user2Panel.querySelector('input').readOnly = true;
                user2Panel.querySelector('input[type="checkbox"]').disabled = true;
            } else {
                user2Panel.querySelector('input').readOnly = false;
                user2Panel.querySelector('input[type="checkbox"]').disabled = false;
                user1Panel.querySelector('input').readOnly = true;
                user1Panel.querySelector('input[type="checkbox"]').disabled = true;
            }

            // Send checkbox update to server
            const checkbox = document.getElementById(isCreator ? 'user1Checkbox' : 'user2Checkbox');
            checkbox.addEventListener('change', () => {
                socket.emit('update_checkbox', lobbyId, checkbox.checked,checkbox.id);
            });


            
        }

        // Listen for checkbox updates from server
        // Listen for checkbox updates from server
        socket.on('checkbox_updated', (data) => {
            const checkbox = document.getElementById(data.checkboxId);
            checkbox.checked = data.isChecked;
            if (document.getElementById('user1Checkbox').checked && document.getElementById('user2Checkbox').checked) {
                socket.emit('start_timer', data.lobbyId);
                document.getElementById('timer').style.display = 'block';
                startTimer();
            }
        });

        socket.on('timer_started',(data)=>{
            document.getElementById('timer').style.display = 'block';
            startTimer();
        });


        function startTimer() {
            // Implement your timer logic here
            // Example:
            let time = 0;
            const timerElement = document.getElementById('timer');
            const timerInterval = setInterval(() => {
                time++;
                timerElement.textContent = 'Timer: ' + time + ' seconds';
            }, 1000);
        }
    </script>
</body>
</html>
